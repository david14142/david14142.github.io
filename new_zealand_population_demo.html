<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  body {font-family: 'Helvetica', sans-serif; font-size: 16px;}
  table {font-family: 'Georgia', serif;}
  th {padding-right: 1em;}
  td {text-align: right; padding-right: 1em;}
  </style>
</head>
<body>

  <script src="Olympus@0.0.1.js"></script>
  <script src="Utility@0.0.1.js"></script>

  <script>

    let f1 = function(row) {
      const g = ['0-9','10-19','20-29','30-39','40-49','50-59','60-69','70-79','80-89','90+'];
      const e = new Map([
        ['ASIAN','Asian'],
        ['EUROTHER','European & Other'],
        ['MAORI','MƒÅori'],
        ['PACIFIC','Pacific'],
        ['MELAA','MELAA']]);
      let a = row['Age'].substr(0,2)/1;
      return {
        Age: a,
        'Age Group': g[Math.floor(a/10)],
        Sex: row['Sex'],
        Ethnicity: e.get(row['ETHNICGROUP']),
        Year: row['YEAR'],
        Value: row['Value']
      }
    }

    pivot1 = function(){
        q.dimension([['Age Group'],['Year','Sex']]);
        document.querySelector('#anchor').innerHTML='';
        q.table({id: 'anchor', column_headers: false, row_totals: false});
    }

    pivot2 = function() {
      q.dimension([['Ethnicity','Sex'],['Year']]);
      document.querySelector('#anchor').innerHTML='';
      q.table({id: 'anchor', column_headers: false, row_totals: false});
    }

    load_pivot = function(){
      if (req.readyState === XMLHttpRequest.DONE && (req.status === 200 || req.status === 0)) {
        p = new Oj.DataFrame(req.response);
        Oj.log('Loaded');
        q = Oj.pivot(p.map(f1), {'Population': Oj.sum('Value')});
        // draw the first table by default
        pivot1();
      }
    }

  </script>

  <h1>New Zealand Population Data</h1>

  <form name='form'>
    <p>Choose table type:</p>
    <div>
      <input type='radio' id='age-sex' name='table' value='pivot1' checked>
      <label for='age-sex'>Age &amp; Sex</label>
      <input type='radio' id='ethnicity-sex' name='table' value='pivot2'>
      <label for='ethnicity-sex'>Ethnicity &amp; Sex</label>
    </div>
  </form>

  <br>

  <!-- use this to write to the document -->
  <div id='anchor'></div>

  <p><i>Source: Statistics New Zealand</i></p>

  <script>

    req = new XMLHttpRequest();
    req.onreadystatechange = load_pivot;
    req.responseType = 'json';
    req.open('GET', 'population.json', true);
    req.send();

    document.form.table[0].onclick = pivot1;
    document.form.table[1].onclick = pivot2;

  </script>

</body>
</html>
